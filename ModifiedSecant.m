clear all; clc;

%****Defining parameter****%

c = 1.040;  % soil cohesion (kPa)
p = 28.5;   % soil internal friction angle (degree)
r = 0.0885; % wheel radius (m)
k = 0.015;  % shear displacement under wheel 
Qm = 5;     % max normal stress angle (degree)
Qf = 35;    % angle between vertical and leading edge of wheel contact patch (degree)
amax = 15;  % max normal stress (kPa)
n = 1.2;    % exponent of terrain deformation 
t = 8.5;    % shear stress (kPa)

% Accuracy/precision 
acc = 0.001;        % Setting the minimal acceptable error

% Define the Wheel Slip, S as a function of Q
Q = 19;             % initial approximation of angle of rotation 
step_size = 0.0001; % small increment 
Q_incre = Q + step_size;

a = amax*(((cos(Q) - cos(Qf))/(cos(Qm) - cos(Qf)))^n);  % normal stress 
T = (c + a*tan(p));                                     % Let T be the variable

S = 1 - (((k/r)*log(-(1 - (t/(c + (amax*(((cos(Q) - cos(Qf))/(cos(Qm) - cos(Qf)))^n))*tan(p))))) + (Qf - Q))/(sin(Qf) - sin(Q)));

% First order derivative expressed as S
dfS = ((6327594006112496925*sin(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1)/(sin(Q) + 964181655394685/2251799813685248) - (cos(Q)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^2;
dfS_incre = ((6327594006112496925*sin(Q_incre)*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1)/(sin(Q_incre) + 964181655394685/2251799813685248) - (cos(Q_incre)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q_incre + 35))/(sin(Q_incre) + 964181655394685/2251799813685248)^2;

% Iterative count
count = 1; % To count the number of iterative to find root

% Modified Secant Iterative
while (abs(dfS)>acc)
    Qnew = Q - ((step_size*dfS)/(dfS_incre-dfS));   % Initiating new Q
    Q = Qnew;                                       % Setting the new Q into Q variable
    Q_incre = Q + step_size;
    
    dfS = ((6327594006112496925*sin(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1)/(sin(Q) + 964181655394685/2251799813685248) - (cos(Q)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^2;
    dfS_incre = ((6327594006112496925*sin(Q_incre)*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1)/(sin(Q_incre) + 964181655394685/2251799813685248) - (cos(Q_incre)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q_incre))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q_incre + 35))/(sin(Q_incre) + 964181655394685/2251799813685248)^2;

    count = count + 1;
end

display(Q)