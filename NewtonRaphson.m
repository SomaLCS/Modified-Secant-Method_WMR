clear all; clc;

%****Defining parameter****%

c = 1.040;  % soil cohesion (kPa)
p = 28.5;   % soil internal friction angle (degree)
r = 0.0885; % wheel radius (m)
k = 0.015;  % shear displacement under wheel
Qm = 5;     % max normal stress angle (degree)
Qf = 35;    % angle between vertical and leading edge of wheel contact patch (degree)
amax = 15;  % max normal stress (kPa)
n = 1.2;    % exponent of terrain deformation 
t = 8.5;    % shear stress (kPa)

%Accuracy/precision 
acc = 0.00001; % Setting the minimal acceptable error

Q = 3.7; % initial approximation of angle of rotation 

%Define the Wheel Slip, S as a function of Q
S = 1 - (((k/r)*log(-(1 - (t/(c + (amax*(((cos(Q) - cos(Qf))/(cos(Qm) - cos(Qf)))^n))*tan(p))))) + (Qf - Q))/(sin(Qf) - sin(Q)));

%First order derivative of S(for root finding of optimal point)
Df_S = ((6327594006112496925*sin(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1)/(sin(Q) + 964181655394685/2251799813685248) - (cos(Q)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^2;

%Second order derivative of S(for finding max/min)
D2f_S = ((471040540072832914972464925389817125*sin(Q)^2*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(2/5))/(13496534609133833080374614108280928*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^3*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - (356211875101000314254466282946560*sin(Q)^2)/(421766706535432283761706690883779*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(4/5)) - (8007689181238159554531903731626891125*sin(Q)^2*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(2/5))/(53986138436535332321498456433123712*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^4*(17/((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/18014398509481984 + 52/25) - 1)^2) + (6327594006112496925*cos(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)))/(sin(Q) + 964181655394685/2251799813685248) + (2*cos(Q)^2*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^3 - (2*cos(Q)*((6327594006112496925*sin(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1))/(sin(Q) + 964181655394685/2251799813685248)^2 + (sin(Q)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^2;

count = 1; % Iterative count

%Newton Raphson Iterative
while (abs(Df_S)>acc)
    Qnew = Q - (Df_S/D2f_S);
    Q = Qnew;

    Df_S = ((6327594006112496925*sin(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1)/(sin(Q) + 964181655394685/2251799813685248) - (cos(Q)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^2;
    D2f_S = ((471040540072832914972464925389817125*sin(Q)^2*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(2/5))/(13496534609133833080374614108280928*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^3*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - (356211875101000314254466282946560*sin(Q)^2)/(421766706535432283761706690883779*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(4/5)) - (8007689181238159554531903731626891125*sin(Q)^2*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(2/5))/(53986138436535332321498456433123712*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^4*(17/((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/18014398509481984 + 52/25) - 1)^2) + (6327594006112496925*cos(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)))/(sin(Q) + 964181655394685/2251799813685248) + (2*cos(Q)^2*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^3 - (2*cos(Q)*((6327594006112496925*sin(Q)*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(1/5))/(1261979034642728248*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)^2*(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1)) - 1))/(sin(Q) + 964181655394685/2251799813685248)^2 + (sin(Q)*((10*log(17/(2*((124070470708088175*((2251799813685248*cos(Q))/2673684395429509 + 8139735756215463/10694737581718036)^(6/5))/36028797018963968 + 26/25)) - 1))/59 - Q + 35))/(sin(Q) + 964181655394685/2251799813685248)^2;
    count = count + 1;
end
display(Q);
    
    


